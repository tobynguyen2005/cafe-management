<!DOCTYPE html>
<html lang="en">
<head th:replace="~{fragments/common :: common-head(
            pageTitle='Product',
            pageSpecificCss=~{:: .page-css}
          )}"></head>
<th:block class="page-css">
    <link rel="stylesheet" href="/assets/css/dashboard/product/create.css">
</th:block>
<body>
<div th:replace="~{fragments/common :: navbar-main}"></div>

<!-- Main Content -->
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">

            <!-- Header Card -->
            <div class="card mb-4">
                <div class="card-body p-3 p-md-4">
                    <div class="d-flex flex-wrap justify-content-between align-items-center">
                        <h2 class="fw-bold mb-0" th:text="${title}">Create Product</h2>
                        <a th:href="@{/product/list}" class="btn btn-outline-secondary">
                            <i class="fa-solid fa-arrow-left me-1"></i> Back to Product List
                        </a>
                    </div>
                </div>
            </div>

            <!-- Form Card -->
            <div class="card shadow-sm">
                <div class="card-body p-4 p-md-5">
                    <form th:action="@{/product/create}" method="post" th:object="${product}"
                          enctype="multipart/form-data">

                        <div class="row g-4">
                            <!-- Column 1: Product Details -->
                            <div class="col-lg-7">
                                <h5 class="fw-bold border-bottom pb-2 mb-3">Product Information</h5>

                                <div class="mb-3">
                                    <label for="proName" class="form-label fw-bold">Name:</label>
                                    <input type="text" id="proName" th:field="*{proName}" class="form-control"
                                           required/>
                                    <div th:if="${nameError}" class="alert alert-danger mt-2 p-2" role="alert">
                                        <span th:text="${nameError}"></span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="price" class="form-label fw-bold">Price (VND):</label>
                                    <input type="number" id="price" th:field="*{price}" min="1000" class="form-control"
                                           required/>
                                    <div th:if="${priceError}" class="alert alert-danger mt-2 p-2" role="alert">
                                        <span th:text="${priceError}"></span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="category" class="form-label fw-bold">Category:</label>
                                    <select class="form-select" id="category" th:field="*{category.cateId}">
                                        <option th:each="category : ${categoryList}"
                                                th:value="${category.cateId}"
                                                th:text="${category.cateName}">
                                        </option>
                                    </select>
                                    <div th:if="${categoryError}" class="alert alert-danger mt-2 p-2" role="alert">
                                        <span th:text="${categoryError}"></span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="description" class="form-label fw-bold">Description:</label>
                                    <textarea id="description" th:field="*{description}" class="form-control"
                                              rows="6"></textarea>
                                    <div th:if="${descriptionError}" class="alert alert-danger mt-2 p-2" role="alert">
                                        <span th:text="${descriptionError}"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Column 2: Image Management -->
                            <div class="col-lg-5">
                                <h5 class="fw-bold border-bottom pb-2 mb-3">Image Management</h5>

                                <div class="mb-3">
                                    <label for="fileInput" class="form-label fw-bold">Upload Image:</label>
                                    <input type="file" id="fileInput" name="file" accept="image/*" class="form-control"
                                           required/>
                                    <small class="form-text text-muted">*Product image is required.</small>
                                    <div th:if="${fileError}" class="alert alert-warning mt-3 p-2">
                                        <span th:text="${fileError}"></span>
                                    </div>
                                </div>

                                <div id="imagePreviewContainer" style="display: none; margin-top: 15px;">
                                    <label class="form-label d-block fw-bold">Image Preview:</label>
                                    <img id="imagePreview" src="#" alt="Image Preview" class="image-preview"/>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-end mt-4 pt-4 border-top">
                            <button type="reset" class="btn btn-outline-secondary me-2">Reset</button>
                            <button type="submit" class="btn btn-outline-primary">Submit</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>
<div th:insert="~{layout/footer}"></div>
<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

<!-- Image Preview JS -->
<script>
    const fileInput = document.getElementById('fileInput');
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const imagePreview = document.getElementById('imagePreview');

    fileInput.addEventListener('change', function (event) {
        const file = event.target.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                imagePreview.src = e.target.result;
                imagePreviewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            imagePreviewContainer.style.display = 'none';
            imagePreview.src = "#";
        }
    });

    // Reset button logic
    const form = document.querySelector('form');
    form.addEventListener('reset', function () {
        imagePreviewContainer.style.display = 'none';
        imagePreview.src = "#";
        fileInput.value = null; // Clear file input
    });
</script>

</body>
</html>